c
nc
n
session.payment_status == "paid"
session.payment_status = "paid"
session.payment_status == "paid"
Stripe::PaymentIntent.retrieve(session.payment_intent)
Stripe::Payment_intent.reterieve(session.payment_intent)
session.payment_intent
session.payment_status
session
session.payment_status
session.payment_status == "paid"
n
current_user.memberships.include?(membership)
n
current_user.memberships.include?(membership)
        n
current_user.plans
current_user
c
n
current_user.plans
current_user.memberships
current_user.memberships.include?(membership)
c
n
 n
current_user.memberships.any? {|x| x.gym_class == membership.gym_class }
   n
current_user.memberships.include?(membership)
membership
 n
c
n
 c
user_plans
users_plans
n
current_user.plans
n
Membership.find_by(id: params[:id])
c
 n
current_user.stripe_id == nil 
c
n
 current_user.update!(stripe_id: stripe_id.id)
stripe_id
n
 n
current_user
current_user.stripe_id
c
 n
stripe_id.id
n
current_user 
current_user.stripe_id 
current_user.stripe_id == nil
c
n
stripe_id
 n
current_user.name
n
c
 n
current_user.name
n
 n
current_user.stripe_id == nil
c
n
c
n
c
n
Stripe::Checkout::Session.retrieve(plan.session_id)
n
current_user.plans.find_by(membership_id: membership.id )
n
current_user.memberships.include?(membership)
current_user.memberships
c
@plan = Plan.create(user_id: @user.id, membership_id: @membership.id, gym_id: @gym, gym_class_id: @gym_class.id, session_id: @session.id)
@plan = Plan.create(user_id: @user.id, membership_id: @membership.id, gym_id: @gym.id, gym_class_id: @gym_class.id, session_id: @session.id)
c
@plan = Plan.create!(user_id: @user.id, membership_id: @membership.id, gym_id: @gym, gym_class_id: @gym_class.id, session_id: @session)
@plan = Plan.create!(user_id: @user.id, membership_id: @membership.id, gym_id: @gym, gym_class_id: @gym_class.id, session_id: @session.id)
@plan = Plan.create!(user_id: @user.id, membership_id: @membership.id, gym_id: @gym.id, gym_class_id: @gym_class.id, session_id: @session.id)
c
n
 n
params
c
 params
c
n
c
n
 n
  old_plan.membership.price
 @new_membership.price
 @new_membership.price - old_plan.membership.price
params
old_plan
n
old_plan
n
user_plans
n
  c
user_plans
 old_plan = user_plans.find_by(gym_class_id: @new_membership.gym_class.id)
n
@new_membership.gym_class.id
@new_membership.id
params
n
c
old_plan = user_plans
old_plan = user_plans.find_by(gym_class_id: @new_membership.gym_class.id)
     n
 @new_membership = Membership.find_by(id: params[:id])
n
c
current_user.plans.where(gym_class_id: 1 ) c
current_user.plans 
current_user.plans.where(gym_class_id: 1 )
current_user.plans.where(gym_class_id:1)
current_user.plans.find_by(gym_class_id:1)
@m.gym_class.id
n
n)
@user
current_user.plans
current_user.plan
params
 n
c
session.payment_status
session =  Stripe::Checkout::Session.retrieve(plan.session_id)
 Stripe::Checkout::Session.retrieve(plan.session_id)
 Stripe::Checkout::session.retrieve(plan.session_id)
plan.session_id
Stripe::Checkout::session.retrieve(plan.session_id)
n
c
plan
Stripe::Checkout::session.reterive(plan.session_id)
n
current_user.plans.find_by(membership_id: membership.id )
    n
 current_user.memberships
c
current_user.memberships
current_user.memberships.include?(membership)
n
c
current_user.plans.pluck(:membership_id).first
current_user.plans.pluck(:membership_id)
current_user.plans.count
current_user.plans
current_user.memberships.where(id: membership.id).first
m = current_user.memberships.where(id: membership.id).first
current_user.memberships.where(id: membership.id).first
current_user.memberships.where(id: membership.id).uniq.first
m = current_user.memberships.where(id: membership.id).uniq.first
current_user.memberships.where(id: membership.id).uniq.first
current_user.memberships.where(id: membership.id).uniq
current_user.memberships.where(id: membership.id)
current_user.memberships
current_user
current_user.plans
membership
plan
n
current_user.plans
current_user
membership.plans
membership
plan = membership.plans.where(membership_id: membership.id)
c
current_user.memberships.include?(membership)
membership.plans
membership.plan
c
gym.plans.first.membership.price.classc
gym.plans.first.membership.price.class
gym.plans.first.membership.price
gym.plans.first.membership
gym.plans.first
c
gym.plans.each do |plan| plan.membership.price end
c
n
 plan.membership.price
 earning += plan.membership.price
n
c
gym.plans.first.membership.price
gym.plans.first.membership
gym.plans.first.amount
gym.plans
n
c
gym
gym.plans
n
  c
 @plan = Plan.create(user_id: @user.id, membership_id: params[:id], gym_id: @gym)
n
 n
@class.gym.id
n
c
n
c
@class.gym.id
@class.gym
@class
  n
@m.gym_class
n
c
 c
c
  @gymclass.video
  @gymclass.video.present?
  @gymclass.images.present?
  @gymclass.images
  @gymclass.imanges
  @gymclass
 @gymclass = GymClass.find(params[:format])
c
 GymClass.find(params[:format]).video.present?c
 GymClass.find(params[:format]).video.present?
 GymClass.find(params[:format]).video
 GymClass.find(params[:format])
 c
@gymclass.video.persisted?
c
 @gymclass.video.present?
 @gymclass.video.class
 @gymclass.video
 @gymclass.video.persisted?
c
 @gymclass.video
 @gymclass
c
 n
@gymclass = GymClass.find(params[:format])
c
 @gymclass
 @gymclass.video.persisted?
